<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SplitAdmin | Дашборд</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <div class="toast-container" id="toastContainer"></div>
    <div class="admin-container">
      <!-- Сайдбар -->
      <aside class="sidebar">
        <div class="logo">
          <i class="fas fa-code-branch"></i>
          <span>SplitAdmin</span>
        </div>
        <nav class="menu">
          <a href="index.html" class="menu-item active">
            <i class="fas fa-chart-line"></i>
            <span>Дашборд</span>
          </a>
          <a href="contractors.html" class="menu-item">
            <i class="fas fa-users"></i>
            <span>Подрядчики</span>
          </a>
          <a href="company.html" class="menu-item">
            <i class="fas fa-building"></i>
            <span>Компания</span>
          </a>
          <a href="nomenclature.html" class="menu-item">
            <i class="fas fa-boxes"></i>
            <span>Номенклатура</span>
          </a>
          <a href="payouts.html" class="menu-item">
            <i class="fas fa-money-bill-transfer"></i>
            <span>Выплаты</span>
          </a>
          <a href="#" id="logoutBtn" class="menu-item">
            <i class="fas fa-right-from-bracket"></i>
            <span>Выход</span>
          </a>
        </nav>
      </aside>

      <!-- Основной контент -->
      <main class="content">
        <header class="header">
          <div class="header-title">
            <h1>Дашборд</h1>
            <p>Обзор статистики и активности</p>
          </div>
          <button class="btn btn-primary" id="generateLinkBtn">
            <i class="fas fa-link"></i>
            Сгенерировать ссылку
          </button>
        </header>

        <!-- Статистика -->
        <div class="dashboard-grid">
          <div class="stats-section">
            <h2>Статистика</h2>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-receipt"></i>
                </div>
                <div class="stat-info">
                  <h3>Всего транзакций</h3>
                  <p class="stat-number" id="payments">124</p>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-info">
                  <h3>Общая сумма</h3>
                  <p class="stat-number" id="total">458 200 ₽</p>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-user-tie"></i>
                </div>
                <div class="stat-info">
                  <h3>Активные подрядчики</h3>
                  <p class="stat-number" id="contractors">8</p>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-info">
                  <h3>Номенклатуры</h3>
                  <p class="stat-number" id="nomenclatures">3</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Последние ссылки -->
          <!-- Последние ссылки -->
          <div class="recent-section">
            <h2>Последние платежные ссылки</h2>
            <div class="links-list" id="recentLinksList">
              <!-- Данные будут загружаться через JavaScript -->
              <div class="loading">Загрузка...</div>
            </div>
          </div>
        </div>
        <!-- Блок аналитики -->
        <div class="analytics-section">
          <div class="section-header">
            <h2>Аналитика платежей</h2>
            <div class="filter-controls">
              <div class="filter-group">
                <label>Статус</label>
                <div class="select-wrapper">
                  <select class="form-select" id="statusFilter">
                    <option value="all">Все статусы</option>
                    <option value="paid">Оплаченные</option>
                    <option value="confirmed">Подтвержденные</option>
                    <option value="new">Новые</option>
                    <option value="rejected">Отклоненные</option>
                    <option value="paidout">Выплаченные</option>
                  </select>
                  <i class="fas fa-chevron-down"></i>
                </div>
              </div>

              <div class="filter-group">
                <label>Сортировка</label>
                <div class="select-wrapper">
                  <select class="form-select" id="sortFilter">
                    <option value="newest">Сначала новые</option>
                    <option value="oldest">Сначала старые</option>
                    <option value="amount_high">По сумме (убыв.)</option>
                    <option value="amount_low">По сумме (возр.)</option>
                  </select>
                  <i class="fas fa-chevron-down"></i>
                </div>
              </div>

              <div class="filter-group">
                <label>Период</label>
                <div class="date-range">
                  <input type="date" class="form-input" id="startDate" />
                  <span>—</span>
                  <input type="date" class="form-input" id="endDate" />
                </div>
              </div>

              <button class="btn btn-secondary" id="resetFilters">
                <i class="fas fa-refresh"></i>
                Сбросить
              </button>
            </div>
          </div>

          <div class="stats-summary" id="statsSummary">
            <!-- Статистика будет здесь -->
          </div>

          <div class="analytics-table-container">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Заказ</th>
                  <th>Клиент</th>
                  <th>Сумма</th>
                  <th>Подрядчик</th>
                  <th>Комиссия</th>
                  <th>Статус</th>
                  <th>Дата создания</th>
                  <th>Действия</th>
                </tr>
              </thead>
              <tbody id="analyticsTableBody">
                <tr>
                  <td colspan="9" class="loading">Загрузка данных...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pagination" id="pagination">
            <!-- Пагинация будет добавляться через JS -->
          </div>
        </div>

        <!-- Модальное окно деталей платежа -->
        <div class="modal" id="paymentDetailsModal">
          <div class="modal-content">
            <div class="modal-header">
              <h2>Детали платежа</h2>
              <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="paymentDetailsContent">
              <!-- Контент будет загружаться через JS -->
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Модальное окно генерации ссылки -->
    <div class="modal" id="generationModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Генерация платежной ссылки</h2>
          <span class="close">&times;</span>
        </div>

        <div class="modal-body">
          <!-- Прогресс-бар -->
          <div class="progress-bar">
            <div class="progress-step active" data-step="1">
              <div class="step-number">1</div>
              <span>Основные данные</span>
            </div>
            <div class="progress-step" data-step="2">
              <div class="step-number">2</div>
              <span>Товары</span>
            </div>
            <div class="progress-step" data-step="3">
              <div class="step-number">3</div>
              <span>Подтверждение</span>
            </div>
          </div>

          <!-- Шаг 1: Основные данные -->
          <div class="step-content active" data-step="1">
            <div class="form-group">
              <label>Сумма для подрядчика (₽)</label>
              <input
                type="number"
                class="form-input"
                id="contractorAmount"
                placeholder="2500"
                min="1"
                required
              />
            </div>
            <button class="btn btn-next">
              Далее
              <i class="fas fa-arrow-right"></i>
            </button>
          </div>

          <!-- Шаг 2: Товары -->
          <div class="step-content" data-step="2">
            <!-- Блок товаров -->
            <div class="nomenclature-header">
              <h3>Добавление товаров</h3>
              <button class="btn btn-add" type="button">
                <i class="fas fa-plus"></i>
                Добавить товар
              </button>
            </div>

            <div class="nomenclature-list" id="nomenclatureList">
              <div class="nomenclature-item">
                <div class="select-wrapper">
                  <select class="form-select product-select">
                    <option value="">-- Выберите товар --</option>
                  </select>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="price-display">
                  <span class="price-label">Цена:</span>
                  <span class="price-value">0 ₽</span>
                </div>
                <input
                  type="number"
                  class="form-input product-amount"
                  placeholder="Введите сумму"
                  min="1"
                />
                <button class="btn btn-remove">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>

            <!-- Поле комиссии -->
            <div class="form-group">
              <label>Комиссия (₽)</label>
              <input
                type="number"
                class="form-input"
                id="commissionAmount"
                placeholder="0"
                min="0"
                required
              />
            </div>

            <div class="step-buttons">
              <button class="btn btn-prev">
                <i class="fas fa-arrow-left"></i>
                Назад
              </button>
              <button class="btn btn-next">
                Далее
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Шаг 3: Подтверждение -->
          <div class="step-content" data-step="3">
            <h3>Итоговая информация</h3>

            <div class="summary-grid">
              <div class="summary-section">
                <h4>Распределение платежа</h4>
                <div class="summary-item">
                  <span class="summary-label">Подрядчик:</span>
                  <span class="summary-value" data-summary="contractor">
                    Будет выбран при выплате - 2 500 ₽
                  </span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Товары:</span>
                  <span class="summary-value" data-summary="products">0 ₽</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Комиссия:</span>
                  <span class="summary-value" data-summary="commission"
                    >0 ₽</span
                  >
                </div>
              </div>

              <div class="summary-section">
                <h4>Детализация товаров</h4>
                <div class="nomenclature-summary">
                  <!-- Товары будут здесь -->
                </div>
              </div>
            </div>

            <div class="summary-total">
              <div class="total-amount">
                <span>Итого к оплате:</span>
                <span class="total-number">0 ₽</span>
              </div>
            </div>

            <div class="step-buttons">
              <button class="btn btn-prev">
                <i class="fas fa-arrow-left"></i>
                Назад
              </button>
              <button class="btn btn-primary" id="generateFinalBtn">
                <i class="fas fa-link"></i>
                Сгенерировать ссылку
              </button>
            </div>
          </div>

          <!-- Шаг 4: Результат -->
          <div class="step-content" data-step="4">
            <div class="success-result">
              <div class="success-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <h3>Ссылка успешно создана!</h3>
              <p>Сумма: <strong></strong></p>

              <div class="generated-link">
                <input type="text" readonly />
                <button class="btn btn-copy">
                  <i class="fas fa-copy"></i>
                </button>
              </div>

              <button class="btn btn-primary" id="closeModalBtn">
                <i class="fas fa-check"></i>
                Готово
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/script.js"></script>
    <script src="assets/js/dashboard.js"></script>
  </body>
</html>
